<!DOCTYPE html>
<html>
<head>
    <title>Title of the document</title>
    <meta charset="utf-8" />
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="./../js/utils.js"></script>
    <script src="./../js/tree-drawer.js"></script>
    <style>
        circle {
            color: black;
        }
    </style>

</head>

<body>

    <button id="startBtn" type="button">
        Start breathFirstSearch
    </button>

    <div id="console"></div>
    <div id="tree"></div>

    
    <svg id="tree-svg"></svg>

<script>

// example of dataset:
var emaGraph = [
    {
        id: "A",
        adj: [{ id: "B"}]
    },
    {
        id: "B",
        adj: [{ id: "C"}, { id: "D"}]
    },
    {
        id: "C",
        adj: [{ id: "E"}]
    },
    {
        id: "D",
        adj: [{ id: "B"},{ id: "A"}]
    },
    {
        id: "E",
        adj: [{ id: "C"}, { id: "E"}]
    }
]


var rawData = {
    "id": 1,
    "children": [
      {
        "id": 2
      },
      {
        "id": 3,
        "children": [
          {
            "id": 4
          },
          {
            "id": 5
          }
        ]
      },
      {
        "id": 6
      }
    ]
}

treeDrawer.drawTree(rawData);

// Global var
var consoleData = [];

document.getElementById("startBtn").addEventListener("click", function() {
    // init variables
    var problem = new Problem("A", "D");
    breathFirstSearch(problem);
});


// breath-first search
function breathFirstSearch(problem) {
    var root;
    for (var i = 0; i < emaGraph.length; i++) {
        if (emaGraph[i].id === problem.initState) {
            root = emaGraph[i];
        }
    }

    log(root.id);

    if (problem.goalState === root.id) {
        log("FOUND PATH");
    }

    var frontier = [root];
    var explored = [];

    while (frontier.length > 0) {
        log("iteration");

        var node = frontier.shift();
        console.log("Frontier: ", frontier);
        
        explored.push(node);

        console.log("Take node: ", node)

        node.adj.forEach(adjNode => {

            // get the node from adjList
            var child = emaGraph.filter(n => {
                return n.id === adjNode.id
            })[0];

            // is already explored?
            var isChildExplored = explored.filter(n => {
                return n.id === child.id;
            });
            if (isChildExplored.length === 0) {
                console.log("Child:", child)
                log(child.id)
                
                if (problem.goalState === child.id) {
                    log("FOUND PATH");
                }

                frontier.push(child);
            }

        });

    }

    return "Failure";
}


function log(msg) {
    // 1. update dataset
    console.log("log", consoleData)
    console.log("msg", msg)
    consoleData.push(msg);

    // 2. rebind dataset
    d3.select("#console")
        .selectAll("div")
        .data(consoleData)
        .enter()
        .append("div")
        .html(d => { return d;} )
}

</script>
        
</body>

</html> 